"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mapFromService = void 0;
const Device_1 = require("./Device");
/**
 * Maps from a Bonjour service to a device.
 */
function mapFromService(service) {
    const addresses = getAddresses(service);
    if (!addresses) {
        return undefined;
    }
    const address = getAddress(addresses);
    if (!address) {
        return undefined;
    }
    const linkLocalAddress = getLinkLocalAddress(addresses);
    if (!linkLocalAddress) {
        return undefined;
    }
    const macAddress = getMacAddress(service);
    if (!macAddress) {
        return undefined;
    }
    return new Device_1.Device(address, linkLocalAddress, service.port, macAddress.toUpperCase(), service.name);
}
exports.mapFromService = mapFromService;
const linkLocalPrefix = '169.254';
function getAddresses(service) {
    if (!service.addresses ||
        service.addresses instanceof Array === false) {
        return undefined;
    }
    for (const address of service.addresses) {
        if (typeof address !== 'string') {
            return undefined;
        }
    }
    return service.addresses;
}
function getAddress(addresses) {
    return addresses.find((address) => !address.startsWith(linkLocalPrefix));
}
function getLinkLocalAddress(addresses) {
    return addresses.find((address) => address.startsWith(linkLocalPrefix));
}
function getMacAddress(service) {
    if (!service.txt ||
        !service.txt.macaddress ||
        typeof service.txt.macaddress !== 'string') {
        return undefined;
    }
    return service.txt.macaddress;
}
//# sourceMappingURL=Mappings.js.map